swagger: "2.0"
info:
  title: T16BGPTless Invoice Generation API
  version: 1.0.0
  description: >
    API for generating and managing standardised UBL invoices, credits, and related
    lifecycle operations.
host: api.example.com
basePath: /
schemes:
  - https

paths:
  /v1/invoices/generate:
    post:
      summary: Generate invoice from order and contract data
      description: Given an Order Document, User Data, Contract Reference and other data, generates a standard and compliant invoice.
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              orderDocument:
                type: string
                description: Order document XML as a string.
              userData:
                type: object
                additionalProperties: true
                description: Invoice data, customer info, payment terms, etc.
              contractReference:
                type: string
                description: Reference used to look up contract pricing and terms.
              otherData:
                type: object
                additionalProperties: true
                description: Optional parameters such as tax rules, special discounts, credit info.
            required:
              - orderDocument
              - userData
              - contractReference
      responses:
        '201':
          description: Invoice successfully generated.
          schema:
            $ref: '#/definitions/Invoice'
        '400':
          description: Missing required fields or malformed XML.
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Contract reference does not exist.
          schema:
            $ref: '#/definitions/Error'
        '422':
          description: Fails business rules (e.g. invalid pricing).
          schema:
            $ref: '#/definitions/Error'

  /v1/invoices:
    get:
      summary: List invoices
      description: Provides a list of all invoices with optional filters.
      produces:
        - application/json
      parameters:
        - in: query
          name: limit
          type: integer
          minimum: 1
          description: Maximum number of invoices to return.
        - in: query
          name: customer
          type: string
          description: Filter by customer identifier.
        - in: query
          name: status
          type: string
          description: Filter by invoice status.
        - in: query
          name: date
          type: string
          format: date
          description: Filter by invoice date.
      responses:
        '200':
          description: List of invoices.
          schema:
            type: array
            items:
              $ref: '#/definitions/InvoiceSummary'
        '400':
          description: Invalid pagination or filtering parameters.
          schema:
            $ref: '#/definitions/Error'

  /v1/invoices/{invoiceId}:
    parameters:
      - in: path
        name: invoiceId
        required: true
        type: string
        description: Unique identifier of the invoice.
    get:
      summary: Get invoice
      description: Given a valid invoiceId, gets all the relevant information about the invoice.
      responses:
        '200':
          description: Invoice retrieved successfully.
          schema:
            $ref: '#/definitions/Invoice'
        '404':
          description: Invoice ID does not exist.
          schema:
            $ref: '#/definitions/Error'
    put:
      summary: Update invoice
      description: Updates invoice user data for the specified invoiceId.
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
            description: Updated user data JSON.
            additionalProperties: true
      responses:
        '200':
          description: Invoice updated successfully.
          schema:
            $ref: '#/definitions/Invoice'
        '404':
          description: Invoice ID does not exist.
          schema:
            $ref: '#/definitions/Error'
        '409':
          description: Cannot modify an invoice that has already been finalised/exported (invalid state).
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Delete invoice
      description: Deletes the specified invoice.
      responses:
        '204':
          description: Invoice deleted successfully. No content returned.
        '404':
          description: Invoice ID does not exist.
          schema:
            $ref: '#/definitions/Error'
        '409':
          description: Cannot delete an invoice that has already been finalised/exported (invalid state).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/invoices/{invoiceId}/export:
    get:
      summary: Export invoice as UBL XML
      description: Given a valid invoiceId, generates and returns the standardised final UBL XML invoice.
      parameters:
        - in: path
          name: invoiceId
          required: true
          type: string
          description: Unique identifier of the invoice.
      responses:
        '200':
          description: UBL XML invoice generated successfully.
          schema:
            type: string
            description: UBL-compliant invoice XML document.
        '400':
          description: Invoice is missing required data for UBL formatting standards.
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Invoice ID does not exist.
          schema:
            $ref: '#/definitions/Error'

  /v1/credits:
    post:
      summary: Raise credit
      description: Raises a credit for an existing invoice.
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              invoiceId:
                type: string
                description: Identifier of the invoice to credit.
              amount:
                type: number
                format: double
                description: Amount to credit.
            required:
              - invoiceId
              - amount
      responses:
        '201':
          description: Credit successfully created.
          schema:
            $ref: '#/definitions/Credit'
        '400':
          description: Amount is zero, negative, or missing.
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Invoice ID does not exist.
          schema:
            $ref: '#/definitions/Error'

  /v1/credits/{creditId}:
    get:
      summary: Get credit
      description: Given a valid creditId, gets all the relevant information for the specified credit.
      parameters:
        - in: path
          name: creditId
          required: true
          type: string
          description: Unique identifier of the credit.
      responses:
        '200':
          description: Credit retrieved successfully.
          schema:
            $ref: '#/definitions/Credit'
        '404':
          description: Credit ID does not exist.
          schema:
            $ref: '#/definitions/Error'

  /v1/invoices/{invoiceId}/apply-credit:
    post:
      summary: Apply credit to invoice
      description: Given a valid invoiceId, applies a specified credit to the appropriate invoice.
      parameters:
        - in: path
          name: invoiceId
          required: true
          type: string
          description: Unique identifier of the invoice.
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              creditId:
                type: string
                description: Identifier of the credit to apply.
              amount:
                type: number
                format: double
                description: Amount of the credit to apply.
            required:
              - creditId
              - amount
      responses:
        '200':
          description: Credit applied successfully.
          schema:
            $ref: '#/definitions/Invoice'
        '400':
          description: Amount exceeds invoice total or available credit.
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Invoice or credit ID does not exist.
          schema:
            $ref: '#/definitions/Error'
        '409':
          description: Credit already applied.
          schema:
            $ref: '#/definitions/Error'

  /v1/invoices/{invoiceId}/status:
    post:
      summary: Update invoice status
      description: Given an invoiceId, validate the invoice and record a status update from an external system.
      parameters:
        - in: path
          name: invoiceId
          required: true
          type: string
          description: Unique identifier of the invoice.
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              currentStatus:
                type: string
                description: Current status reported by the accounting/financial system.
            required:
              - currentStatus
      responses:
        '200':
          description: Status update recorded and logged.
          schema:
            type: object
            properties:
              invoiceId:
                type: string
              currentStatus:
                type: string
              message:
                type: string
        '404':
          description: Invoice ID does not exist.
          schema:
            $ref: '#/definitions/Error'
        '422':
          description: Invalid status payload received from the accounting/financials system.
          schema:
            $ref: '#/definitions/Error'

definitions:
  Invoice:
      type: object
      description: Full invoice representation.
      properties:
        invoiceId:
          type: string
        status:
          type: string
        customerId:
          type: string
        issueDate:
          type: string
          format: date
        dueDate:
          type: string
          format: date
        totalAmount:
          type: number
          format: double
        currency:
          type: string
          example: AUD
        lines:
          type: array
          items:
            type: object
            properties:
              lineId:
                type: string
              description:
                type: string
              quantity:
                type: number
              unitPrice:
                type: number
              lineTotal:
                type: number
        creditsApplied:
          type: array
          items:
            $ref: '#/components/schemas/Credit'
      required:
        - invoiceId
        - status
        - totalAmount

  InvoiceSummary:
      type: object
      description: Lightweight summary of an invoice.
      properties:
        invoiceId:
          type: string
        status:
          type: string
        customerId:
          type: string
        issueDate:
          type: string
          format: date
        totalAmount:
          type: number
          format: double
      required:
        - invoiceId
        - status

  Credit:
      type: object
      description: Credit associated with an invoice.
      properties:
        creditId:
          type: string
        invoiceId:
          type: string
        status:
          type: string
        amount:
          type: number
          format: double
        createdAt:
          type: string
          format: date-time
      required:
        - creditId
        - invoiceId
        - amount

  Error:
      type: object
      description: Error response payload.
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
      required:
        - code
        - message

